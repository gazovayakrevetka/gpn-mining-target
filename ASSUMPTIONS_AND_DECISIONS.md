## Допущения и решения по проекту

### 1. Источник и формат данных

- Основной источник: файл `mining_block_model.xlsx` в папке `GPN2`.  
  Если его нет, используется `mining_block_model.csv` в той же папке.
- Структура столбцов соответствует постановке задачи (включая `Target`).

---

### 2. Обработка пропусков и типов данных

- Строки с пропусками в целевой переменной `Target` удаляются.
- Числовые признаки:
  - `X`, `Y`, `Z`
  - `Ore_Grade (%)`
  - `Tonnage`
  - `Ore_Value (USD/tonne)`
  - `Mining_Cost (USD)`
  - `Processing_Cost (USD)`
  - `Waste_Flag`

  приводятся к числовому типу и пропуски заполняются медианой по столбцу.

- `Waste_Flag`, если он логического типа (`bool`), приводится к `int` (0/1).
- Для `Rock_Type` пропуски заменяются модой, при её отсутствии – `"Unknown"`.

---

### 3. Выбор признаков и создание новых

- Входные признаки:
  - числовые:
    - `X`, `Y`, `Z`
    - `Ore_Grade (%)`
    - `Tonnage`
    - `Ore_Value (USD/tonne)`
    - `Mining_Cost (USD)`
    - `Processing_Cost (USD)`
    - `Waste_Flag`
    - новый признак `Total_Cost_per_tonne` = `Mining_Cost (USD)` + `Processing_Cost (USD)`
  - категориальный:
    - `Rock_Type`

- `Block_ID` и `Profit (USD)` не используются в качестве признаков, чтобы не усложнять модель
  и не вносить потенциальную утечку информации.

---

### 4. Кодирование и масштабирование

- Для `Rock_Type` используется **One-Hot Encoding** (`OneHotEncoder(sparse=False, handle_unknown="ignore")`):
  - даёт простую и интерпретируемую структуру признаков;
  - `handle_unknown="ignore"` позволяет обрабатывать неизвестные типы пород в приложении.

- Все числовые признаки масштабируются `StandardScaler`:
  - важно для MLP и полезно для линейной регрессии и XGBoost.

---

### 5. Разбиение на обучающую и тестовую выборки

- `train_test_split` со следующими параметрами:
  - `test_size=0.2`
  - `random_state=42`

Таким образом, 80% данных используется для обучения, 20% — для финальной проверки.

---

### 6. Модели и критерий выбора

- Базовые модели:
  - `LinearRegression`
  - `RandomForestRegressor`
  - `XGBRegressor`
  - `MLPRegressor`

- Метрики на 5-fold CV:
  - `RMSE` (через `neg_root_mean_squared_error`)
  - `R²`

- Для двух лучших по RMSE моделей выполняется `RandomizedSearchCV`
  с небольшими пространствами гиперпараметров.

- Итоговый выбор лучшей модели делается по **RMSE на тестовой выборке**,
  при этом также сохраняются `MAE` и `R²`.

---

### 7. Интеграция со Streamlit‑приложением

- `encoder.pkl`, `scaler.pkl`, `preprocessing_metadata.pkl` и `best_model.pkl`
  используются как в моделировании, так и в `app.py`.
- Приложение поддерживает:
  - ввод одного блока через форму;
  - загрузку CSV/XLSX с несколькими блоками и скачивание результатов;
  - построение графика «предсказание vs факт» при наличии `Target`.

---

### 8. Воспроизводимость и простота

- Для всех операций со случайностью (`train_test_split`, модели) задан `random_state=42`.
- Код специально сделан как можно короче и проще, чтобы его было легко читать, менять
  и переносить в другой репозиторий или окружение.

